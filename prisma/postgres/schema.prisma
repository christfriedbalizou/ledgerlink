// Multi-provider schema (PostgreSQL variant)
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// Models (kept identical across providers for now)
model User {
  id           String        @id @default(uuid())
  email        String        @unique
  plaidItemId   String
  plaidAccountId String? @unique
  accounts     Account[]
  name          String?
  officialName  String?
  mask          String? @db.VarChar(8)
  type          String?
  subtype       String?
  balanceAvailable  Float?
  balanceCurrent    Float?
  balanceIsoCurrency String?
  plaidItems   PlaidItem[]
  institutions Institution[]
  settings     UserSetting?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model Institution {
  id                 String      @id @default(uuid())
  userId             String
  plaidInstitutionId String
  name               String
  logo               String?
  primaryColor       String?
  url                String?
  createdAt          DateTime    @default(now())
  updatedAt          DateTime    @updatedAt
  user               User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  accounts           Account[]
  plaidItems         PlaidItem[]

  @@unique([userId, plaidInstitutionId])
}

model Account {
  id            String       @id @default(uuid())
  userId        String
  plaidItemId   String       @unique
  institutionId String
  name          String?
  officialName  String?
  mask          String? @db.VarChar(8)
  type          String?
  subtype       String?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  user          User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  institution   Institution  @relation(fields: [institutionId], references: [id], onDelete: Cascade)
}

model PlaidItem {
  id               String       @id @default(uuid())
  userId           String
  plaidItemId      String       @unique
  plaidAccessToken String       // Encrypted
  products         String       // Comma-separated list of products
  institutionId    String
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  user             User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  institution      Institution  @relation(fields: [institutionId], references: [id], onDelete: Cascade)
}

model UserSetting {
  id                String   @id @default(uuid())
  userId            String   @unique
  enableActual      Boolean?
  enableEmailExport Boolean?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}
